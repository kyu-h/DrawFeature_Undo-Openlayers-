/*!
OpenLayers 3 interaction that allows to rotate vector features

@package ol3-rotate-feature
@author Vladimir Vershinin <ghettovoice@gmail.com>
@version 1.2.2
@licence MIT https://opensource.org/licenses/MIT
         Based on OpenLayers 3. Copyright 2005-2016 OpenLayers Contributors. All rights reserved. http://openlayers.org
@copyright (c) 2016, Vladimir Vershinin <ghettovoice@gmail.com>
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("openlayers")):"function"==typeof define&&define.amd?define(["openlayers"],t):"object"==typeof exports?exports.RotateFeature=t(require("openlayers")):(e.ol=e.ol||{},e.ol.interaction=e.ol.interaction||{},e.ol.interaction.RotateFeature=t(e.ol))}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="/dist/",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),a=n(o);t.default=a.default,e.exports=t.default},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.RotateFeatureEventType={START:"rotatestart",ROTATING:"rotating",END:"rotateend"},t.RotateFeatureEvent=function(){function e(t,n,o,a){r(this,e),this.propagationStopped=void 0,this.type=t,this.features=n,this.angle=o,this.anchor=a}return n(e,[{key:"preventDefault",value:function(){this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),e}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e});return!t||this.lastCoordinate_||!this.features_.getArray().includes(t)&&t!==this.arrowFeature_?!(!t||t!==this.anchorFeature_)&&(this.anchorMoving_=!0,h.call(this,e),!0):(this.lastCoordinate_=e.coordinate,h.call(this,e),this.dispatchRotateStartEvent_(this.features_),!0)}function l(e){return this.lastCoordinate_?(this.lastCoordinate_=void 0,h.call(this,e),this.dispatchRotateEndEvent_(this.features_),!0):!!this.anchorMoving_&&(this.anchorMoving_=!1,h.call(this,e),!0)}function c(e){var t=e.coordinate,r=this.anchorFeature_.getGeometry().getCoordinates();if(this.lastCoordinate_){var n=[this.lastCoordinate_[0]-r[0],this.lastCoordinate_[1]-r[1]],o=[t[0]-r[0],t[1]-r[1]],a=Math.atan2(n[0]*o[1]-o[0]*n[1],n[0]*o[0]+n[1]*o[1]);this.setAngle(this.getAngle()+a),this.dispatchRotatingEvent_(this.features_),this.lastCoordinate_=e.coordinate}else this.anchorMoving_&&this.setAnchor(t)}function h(e){var t=e.map.getTargetElement(),r=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e}),n=function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r&&(t.style.cursor="-webkit-"+e,t.style.cursor="-moz-"+e),t.style.cursor=e};this.lastCoordinate_?(this.previousCursor_=t.style.cursor,n("grabbing",!0)):r&&(this.features_.getArray().includes(r)||r===this.arrowFeature_)?(this.previousCursor_=t.style.cursor,n("grab",!0)):r&&r===this.anchorFeature_||this.anchorMoving_?(this.previousCursor_=t.style.cursor,n("crosshair")):(n(this.previousCursor_||""),this.previousCursor_=void 0)}function f(){var e,t=[255,255,255,.8],r=[0,153,255,.8],n=[255,255,255,.01],a=2,i=(e={},o(e,w,[new y.default.style.Style({image:new y.default.style.RegularShape({fill:new y.default.style.Fill({color:[0,153,255,.8]}),stroke:new y.default.style.Stroke({color:r,width:1}),radius:4,points:6}),zIndex:1/0})]),o(e,m,[new y.default.style.Style({fill:new y.default.style.Fill({color:n}),stroke:new y.default.style.Stroke({color:t,width:a+2}),text:new y.default.style.Text({font:"12px sans-serif",offsetX:20,offsetY:-20,fill:new y.default.style.Fill({color:"blue"}),stroke:new y.default.style.Stroke({color:t,width:a+1})}),zIndex:1/0}),new y.default.style.Style({fill:new y.default.style.Fill({color:n}),stroke:new y.default.style.Stroke({color:r,width:a}),zIndex:1/0})]),e);return function(e,t){var r,n=e.get(b)||0;switch(!0){case e.get(w):return r=i[w],r[0].getImage().setRotation(-n),r;case e.get(m):r=i[m];var o=e.getGeometry().getCoordinates(),a=new y.default.geom.Polygon([[[o[0],o[1]-6*t],[o[0]+8*t,o[1]-12*t],[o[0],o[1]+30*t],[o[0]-8*t,o[1]-12*t],[o[0],o[1]-6*t]]]);return a.rotate(n,o),r[0].setGeometry(a),r[1].setGeometry(a),r[0].getText().setText(Math.round(180*-n/Math.PI)+"Â°"),r}}}function d(e){if(e.getLength())return new y.default.geom.GeometryCollection((Array.isArray(e)?e:e.getArray()).map(function(e){return e.getGeometry()})).getExtent()}function g(e){if(e.getLength())return y.default.extent.getCenter(d(e))}Object.defineProperty(t,"__esModule",{value:!0});var v=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in o)return o.value;var i=o.get;if(void 0!==i)return i.call(n)},p=r(4),y=n(p),F=r(3),A=r(1),w="anchor",m="arrow",b="angle",E="anchor",C=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{handleEvent:t.handleEvent,handleDownEvent:u,handleUpEvent:l,handleDragEvent:c,handleMoveEvent:h}));return null!=e.angle&&r.setAngle(e.angle),null!=e.anchor&&r.setAnchor(e.anchor),r.features_=e.features,(0,F.assertInstanceOf)(r.features_,y.default.Collection),r.overlay_=new y.default.layer.Vector({style:e.style||f(),source:new y.default.source.Vector({features:new y.default.Collection})}),r.previousCursor_=void 0,r.anchorFeature_=void 0,r.arrowFeature_=void 0,r.lastCoordinate_=void 0,r.anchorMoving_=!1,r.features_.on("add",r.onFeatureAdd_,r),r.features_.on("remove",r.onFeatureRemove_,r),r.on("change:active",r.onChangeActive_,r),r.on("change:"+b,r.onAngleChange_,r),r.on("change:"+E,r.onAnchorChange_,r),r}return s(t,e),v(t,[{key:"setMap",value:function(e){this.overlay_.setMap(e),_(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setMap",this).call(this,e),e?this.updateInteractionFeatures_():this.reset_(!0)}},{key:"onChangeActive_",value:function(){this.getActive()?this.updateInteractionFeatures_():this.reset_(!0)}},{key:"setAngle",value:function(e){(0,F.assert)(!isNaN(parseFloat(e)),"Numeric value passed"),this.set(b,parseFloat(e))}},{key:"getAngle",value:function(){return(0,F.coalesce)(this.get(b),0)}},{key:"setAnchor",value:function(e){(0,F.assert)(null==e||Array.isArray(e)&&2===e.length,"Array of two elements passed"),this.set(E,null!=e?e.map(parseFloat):void 0)}},{key:"getAnchor",value:function(){return(0,F.coalesce)(this.get(E),g(this.features_))}},{key:"updateInteractionFeatures_",value:function(){return this.features_.getLength()?(this.createOrUpdateAnchorFeature_(),void this.createOrUpdateArrowFeature_()):void this.reset_()}},{key:"reset_",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t&&this.resetAngleAndAnchor_(),[this.anchorFeature_,this.arrowFeature_].forEach(function(t){t&&e.overlay_.getSource().removeFeature(t)}),this.anchorFeature_=this.arrowFeature_=this.lastCoordinate_=void 0,this.anchorMoving_=!1}},{key:"resetAngleAndAnchor_",value:function(){this.resetAngle_(),this.resetAnchor_()}},{key:"resetAngle_",value:function(){this.set(b,0,!0),this.arrowFeature_&&this.arrowFeature_.set(b,this.getAngle()),this.anchorFeature_&&this.anchorFeature_.set(b,this.getAngle())}},{key:"resetAnchor_",value:function(){this.set(E,g(this.features_),!0),this.getAnchor()&&(this.arrowFeature_&&this.arrowFeature_.getGeometry().setCoordinates(this.getAnchor()),this.anchorFeature_&&this.anchorFeature_.getGeometry().setCoordinates(this.getAnchor()))}},{key:"createOrUpdateAnchorFeature_",value:function(){var e=this.getAngle(),t=this.getAnchor();if(this.anchorFeature_)this.anchorFeature_.getGeometry().setCoordinates(t);else{var r;this.anchorFeature_=new y.default.Feature((r={geometry:new y.default.geom.Point(t)},o(r,w,!0),o(r,b,e),r)),this.overlay_.getSource().addFeature(this.anchorFeature_)}}},{key:"createOrUpdateArrowFeature_",value:function(){var e=this.getAngle(),t=this.getAnchor();if(this.arrowFeature_)this.arrowFeature_.getGeometry().setCoordinates(t);else{var r;this.arrowFeature_=new y.default.Feature((r={geometry:new y.default.geom.Point(t)},o(r,m,!0),o(r,b,e),r)),this.overlay_.getSource().addFeature(this.arrowFeature_)}}},{key:"onFeatureAdd_",value:function(e){var t=e.element;this.getActive()&&((0,F.assertInstanceOf)(t,y.default.Feature),this.resetAngleAndAnchor_(),this.updateInteractionFeatures_())}},{key:"onFeatureRemove_",value:function(e){var t=e.element;this.getActive()&&((0,F.assertInstanceOf)(t,y.default.Feature),this.resetAngleAndAnchor_(),this.updateInteractionFeatures_())}},{key:"onAngleChange_",value:function(e){var t=this,r=e.oldValue;this.features_.forEach(function(e){return e.getGeometry().rotate(t.getAngle()-r,t.anchorFeature_.getGeometry().getCoordinates())}),this.arrowFeature_&&this.arrowFeature_.set(b,this.getAngle()),this.anchorFeature_&&this.anchorFeature_.set(b,this.getAngle())}},{key:"onAnchorChange_",value:function(){var e=this.getAnchor();e&&(this.anchorFeature_&&this.anchorFeature_.getGeometry().setCoordinates(e),this.arrowFeature_&&this.arrowFeature_.getGeometry().setCoordinates(e))}},{key:"dispatchRotateStartEvent_",value:function(e){this.dispatchEvent(new A.RotateFeatureEvent(A.RotateFeatureEventType.START,e,this.getAngle(),this.getAnchor()))}},{key:"dispatchRotatingEvent_",value:function(e){this.dispatchEvent(new A.RotateFeatureEvent(A.RotateFeatureEventType.ROTATING,e,this.getAngle(),this.getAnchor()))}},{key:"dispatchRotateEndEvent_",value:function(e){this.dispatchEvent(new A.RotateFeatureEvent(A.RotateFeatureEventType.END,e,this.getAngle(),this.getAnchor()))}}],[{key:"handleEvent",value:function(e){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e});return!(["click","singleclick"].includes(e.type)&&t&&[this.anchorFeature_,this.arrowFeature_].includes(t))&&y.default.interaction.Pointer.handleEvent.call(this,e)}}]),t}(y.default.interaction.Pointer);t.default=C,e.exports=t.default},function(e,t){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t=["Assertion failed",t].join(": "),!e)throw new Error(t)}function n(e,t){r(e instanceof t,"Expected instanceof "+i(t)+" but got "+i(e)+".")}function o(){}function a(e){return e}function i(e){return e instanceof Function?e.name||"unknown type name":e instanceof Object?e.constructor.name||Object.prototype.toString.call(e):null===e?"null":"undefined"==typeof e?"undefined":u(e)}function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.find(function(e){return null!=e})}Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};t.assert=r,t.assertInstanceOf=n,t.noop=o,t.identity=a,t.getValueType=i,t.coalesce=s},function(t,r){t.exports=e}])});
//# sourceMappingURL=bundle.min.js.map